(()=>{var g=["silver","gray"],u=(o,t,n)=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),o.forEach(e=>x(e,t,n))},x=(o,t,n)=>{let e=Math.min(o.tilePosition[0].x,o.tilePosition[1].x),i=Math.min(o.tilePosition[0].y,o.tilePosition[1].y),r=Math.max(o.tilePosition[0].x,o.tilePosition[1].x),l=Math.max(o.tilePosition[0].y,o.tilePosition[1].y),a={x:e*n,y:i*n},y={x:r*n+n,y:l*n+n};t.lineWidth=2,t.beginPath(),t.roundRect(a.x,a.y,y.x-a.x,y.y-a.y,10),t.fillStyle=g[o.id%g.length],t.fill(),t.strokeStyle="black",t.stroke()};var s=class{constructor(t,n){this.x=t;this.y=n}isEqual(t){return this.x===t.x&&this.y===t.y}},d=class{constructor(t,n=Math.floor(Math.random()*32)){this.tilePosition=t;this.id=n}overlaps(t){return t.tilePosition.some(n=>this.tilePosition.some(e=>e.isEqual(n)))}},b=class o{constructor(t,n,e){this.width=t;this.height=n;this.tiles=e}occupiedPositions(){return this.tiles.flatMap(t=>t.tilePosition)}isInBounds(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height}isFreePosition(t){return this.isInBounds(t)&&!this.occupiedPositions().some(n=>n.isEqual(t))}freePositions(){let t=[];for(let n=0;n<this.width;n++)for(let e=0;e<this.height;e++){let i=new s(n,e);this.isFreePosition(i)&&t.push(i)}return t}isComplete(){return this.occupiedPositions().length===this.width*this.height}hasConnectedVacancy(){let t=this.freePositions();if(t.length===0)return!0;let n=[t[0]],e=[];for(;n.length>0;){let i=n.pop();if(e.some(l=>l.isEqual(i)))continue;e.push(i);let r=[new s(i.x-1,i.y),new s(i.x+1,i.y),new s(i.x,i.y-1),new s(i.x,i.y+1)];for(let l of r)t.some(a=>a.isEqual(l))&&!e.some(a=>a.isEqual(l))&&n.push(l)}return e.length===t.length}generateChildren(){let t=this.freePositions().map(i=>({value:i,rank:Math.random()})).toSorted((i,r)=>i.rank-r.rank).map(({value:i})=>i);if(t.length===0)return[];let n=null,e=[];for(let i of t){let r=[new s(i.x-1,i.y),new s(i.x+1,i.y),new s(i.x,i.y-1),new s(i.x,i.y+1)].filter(l=>this.isFreePosition(l));(n===null||r.length<e.length)&&(n=i,e=r)}return e.map(i=>{let r=new d([n,i]);return new o(this.width,this.height,[...this.tiles,r])})}},c=class{constructor(t,n,e=[],i=!1,r=!0){this.parent=t;this.tiling=n;this.children=e;this.visited=i;this.viable=r}};function*f(o,t){let e=new c(null,new b(o,t,[]));for(yield e.tiling.tiles;!e.tiling.isComplete();){if(!e.viable){if(e=e.parent,yield e.tiling.tiles,!e)throw new Error("No complete tiling found");let r=e.tiling.hasConnectedVacancy();for(;!r;){if(e.viable=!1,e=e.parent,yield e.tiling.tiles,!e)throw new Error("No complete tiling found");r=e.tiling.hasConnectedVacancy()}}e.visited||(e.children=e.tiling.generateChildren().map(r=>new c(e,r)),e.visited=!0);let i=e.children.filter(r=>r.viable);if(i.length===0){e.viable=!1;continue}e=i[Math.floor(Math.random()*i.length)],yield e.tiling.tiles}return e.tiling.tiles}var v=document.getElementById("generate-button"),E=document.querySelector("canvas"),p=E.getContext("2d"),h=null,C=1e3,m=30,P=C/m,w=async()=>{h&&h.abort(),h=new AbortController;let o=h.signal;try{let t=f(m,m),n=t.next();for(u(n.value,p,P);!n.done;){if(o.aborted)return;await new Promise((e,i)=>{let r=setTimeout(e,1);o.addEventListener("abort",()=>{clearTimeout(r),i(new DOMException("Operation cancelled","AbortError"))})}),n=t.next(),u(n.value,p,P)}}catch(t){if(t instanceof DOMException&&t.name==="AbortError")return;throw t}};v.addEventListener("click",w);w();})();
//# sourceMappingURL=index.js.map
