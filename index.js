(()=>{var g=["silver","gray"],u=(o,t,n)=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),o.forEach(i=>x(i,t,n))},x=(o,t,n)=>{let i=Math.min(o.tilePosition[0].x,o.tilePosition[1].x),e=Math.min(o.tilePosition[0].y,o.tilePosition[1].y),r=Math.max(o.tilePosition[0].x,o.tilePosition[1].x),l=Math.max(o.tilePosition[0].y,o.tilePosition[1].y),a={x:i*n,y:e*n},y={x:r*n+n,y:l*n+n};t.lineWidth=2,t.beginPath(),t.roundRect(a.x,a.y,y.x-a.x,y.y-a.y,10),t.fillStyle=g[o.id%g.length],t.fill(),t.strokeStyle="black",t.stroke()};var s=class{constructor(t,n){this.x=t;this.y=n}isEqual(t){return this.x===t.x&&this.y===t.y}},d=class{constructor(t,n=Math.floor(Math.random()*32)){this.tilePosition=t;this.id=n}overlaps(t){return t.tilePosition.some(n=>this.tilePosition.some(i=>i.isEqual(n)))}},b=class o{constructor(t,n,i){this.width=t;this.height=n;this.tiles=i}occupiedPositions(){return this.tiles.flatMap(t=>t.tilePosition)}isInBounds(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height}isFreePosition(t){return this.isInBounds(t)&&!this.occupiedPositions().some(n=>n.isEqual(t))}freePositions(){let t=[];for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){let e=new s(n,i);this.isFreePosition(e)&&t.push(e)}return t}isComplete(){return this.occupiedPositions().length===this.width*this.height}hasConnectedVacancy(){let t=this.freePositions();if(t.length===0)return!0;let n=[t[0]],i=[];for(;n.length>0;){let e=n.pop();if(i.some(l=>l.isEqual(e)))continue;i.push(e);let r=[new s(e.x-1,e.y),new s(e.x+1,e.y),new s(e.x,e.y-1),new s(e.x,e.y+1)];for(let l of r)t.some(a=>a.isEqual(l))&&!i.some(a=>a.isEqual(l))&&n.push(l)}return i.length===t.length}generateChildren(){let t=this.freePositions().map(e=>({value:e,rank:Math.random()+-1*Math.sqrt(Math.abs(e.x-this.width/2)**2+Math.abs(e.y-this.height/2)**2)})).toSorted((e,r)=>e.rank-r.rank).map(({value:e})=>e);if(t.length===0)return[];let n=null,i=[];for(let e of t){let r=[new s(e.x-1,e.y),new s(e.x+1,e.y),new s(e.x,e.y-1),new s(e.x,e.y+1)].filter(l=>this.isFreePosition(l));(n===null||r.length<i.length)&&(n=e,i=r)}return i.map(e=>{let r=new d([n,e]);return new o(this.width,this.height,[...this.tiles,r])})}},c=class{constructor(t,n,i=[],e=!1,r=!0){this.parent=t;this.tiling=n;this.children=i;this.visited=e;this.viable=r}};function*f(o,t){let i=new c(null,new b(o,t,[]));for(yield i.tiling.tiles;!i.tiling.isComplete();){if(!i.viable){if(i=i.parent,yield i.tiling.tiles,!i)throw new Error("No complete tiling found");let r=i.tiling.hasConnectedVacancy();for(;!r;){if(i.viable=!1,i=i.parent,yield i.tiling.tiles,!i)throw new Error("No complete tiling found");r=i.tiling.hasConnectedVacancy()}}i.visited||(i.children=i.tiling.generateChildren().map(r=>new c(i,r)),i.visited=!0);let e=i.children.filter(r=>r.viable);if(e.length===0){i.viable=!1;continue}i=e[Math.floor(Math.random()*e.length)],yield i.tiling.tiles}return i.tiling.tiles}var E=document.getElementById("generate-button"),v=document.querySelector("canvas"),p=v.getContext("2d"),h=null,C=1e3,m=30,w=C/m,P=async()=>{h&&h.abort(),h=new AbortController;let o=h.signal;try{let t=f(m,m),n=t.next();for(u(n.value,p,w);!n.done;){if(o.aborted)return;await new Promise((i,e)=>{let r=setTimeout(i,1);o.addEventListener("abort",()=>{clearTimeout(r),e(new DOMException("Operation cancelled","AbortError"))})}),n=t.next(),u(n.value,p,w)}}catch(t){if(t instanceof DOMException&&t.name==="AbortError")return;throw t}};E.addEventListener("click",P);P();})();
//# sourceMappingURL=index.js.map
